## Хостинг NodeJS приложения на [Heroku](https://www.heroku.com/)

### Начало работы 

* Создайте учетную запись [Heroku](https://www.heroku.com/). 
* Установите [инструменты Heroku для командной строки](https://devcenter.heroku.com/articles/heroku-command-line#download-and-install). После установки в консоли станет доступна команда heroku. 


* Убедитесь, что git установлен на вашем пк. 

### Подготовка приложения для загрузки на хостинг 

* Перейдите в директорию с вашим приоложением. 

* Создайте файл package.json с зависимостями, необходимыми для работы приложения. 
* Добавьте в файл package.json информацию о версиях node и npm, необходимых для работы вашего приложения: 
```
  "engines": {
    "node": "0.10.x",
    "npm": "1.3.x"
  }
```

* Запустите git bash (кликните правой кнопкой мыши и выберите пункт меню git bash here). 
* Создайте локальный репозиторий git. Выполните команду 
```
$ git init
```


* Создайте в директории с вашим приложением файл без расширения с именем Procfile (для создания файла введите в качестве имени файла '.Procfile.' и нажмите Enter). Этот файл используется Heroku для запуска приложения. Пропишите в файле следующее: 

```
web: port=$PORT node server.js
```
port - переменная окружения nodeJS 
server.js - файл, который будет запущен после того, как приложение будет загружено на хостинг


### Загрузка приложения на хостинг

* Выполните следующие команды в git bash: 
```
$ git add . 
$ git commit -a -m 'first commit'
```

* Создайте удалённый репозиторий Heroku: 
```
$ heroku create 
```
В результате выполнения команды будет создан удаленный репозиторий Heroku с именем вашего приложения. 


* Для загрузки файлов приложения на сервер выполните следующую команду: 
```
$ git push heroku master
```

* Для открытия приложения в браузере выполните команду: 
```
$ heroku open
```

* В случае ошибки при загрузке, запуске или в процессе работы приложения, выполните в директории с приложением команду: 
```
heroku logs
```
Данная команда выведет в консоль информацию для отладки приложения. 


### Подключение MySQL 

* Выполните команду консоли в директории с приложением: 

```
$ heroku addons:create cleardb:ignite
```
В ваше приложение будет добавлена база данных mysql.


* Для получения данных для подключения к базе данных выполните команду консоли: 
```
$ heroku config | grep CLEARDB_DATABASE_URL 
```
Результатом выполнения команды будет вывод в консоль строки в формате: 

mysql://<username>:<password>@<host>:<port>/<db>

* Используйте полученные данные для подключения к базе данных. 


Например, данные для подключения к бд:
mysql://b4f0b395bbd112:82c9df4e@us-cdbr-iron-east-04.cleardb.net/heroku_7bc3d4c8f208e15?reconnect=true

Подключение к бд с помощью node-mysql: 
```
mysql.createConnection({
    host: 'us-cdbr-iron-east-04.cleardb.net',
    port: 3306,
    user: 'b4f0b395bbd112',
    password: '82c9df4e',
    database: 'heroku_7bc3d4c8f208e15'
})
``` 


* Инструкция по импорту данных в бд [здесь](../importing_data.md). 


